kind: pipeline
name: default
clone:
  depth: 1

# XXX hack for cwd failure
workspace:
  base: /tmp
  path: "."
# /XXX

trigger:
  branch:
  - master
  event:
  - push

steps:
#- name: build-master
#  image: plugins/ecr
#  settings:
#    repo: 577012953595.dkr.ecr.us-west-2.amazonaws.com/relay-web-app
#    registry: 577012953595.dkr.ecr.us-west-2.amazonaws.com
#    region: us-west-2
#    tags: dev,commit-${DRONE_COMMIT},build-${DRONE_BUILD_NUMBER}
#    cache_from: 577012953595.dkr.ecr.us-west-2.amazonaws.com/relay-web-app:dev
- name: deploy
  image: quay.io/honestbee/drone-kubernetes
  settings:
    kubernetes_server: https://10.100.152.223
    kubernetes_token: "ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNklpSjkuZXlKcGMzTWlPaUpyZFdKbGNtNWxkR1Z6TDNObGNuWnBZMlZoWTJOdmRXNTBJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5dVlXMWxjM0JoWTJVaU9pSmtaV1poZFd4MElpd2lhM1ZpWlhKdVpYUmxjeTVwYnk5elpYSjJhV05sWVdOamIzVnVkQzl6WldOeVpYUXVibUZ0WlNJNkltUnliMjVsTFdWcmN5MWtaWEJzYjNsbGNpMTBiMnRsYmkxa2NXWjZiU0lzSW10MVltVnlibVYwWlhNdWFXOHZjMlZ5ZG1salpXRmpZMjkxYm5RdmMyVnlkbWxqWlMxaFkyTnZkVzUwTG01aGJXVWlPaUprY205dVpTMWxhM010WkdWd2JHOTVaWElpTENKcmRXSmxjbTVsZEdWekxtbHZMM05sY25acFkyVmhZMk52ZFc1MEwzTmxjblpwWTJVdFlXTmpiM1Z1ZEM1MWFXUWlPaUkxTlRBMVlXRmhNaTB4TkdJMExURXhaVGt0T0dKbVpTMHdObUUyWlRKaU1UZGtaallpTENKemRXSWlPaUp6ZVhOMFpXMDZjMlZ5ZG1salpXRmpZMjkxYm5RNlpHVm1ZWFZzZERwa2NtOXVaUzFsYTNNdFpHVndiRzk1WlhJaWZRLm5FZXVVbjRORDlDVVFNdmw5M09HTWZYUTA5eVdqaUROXzdVRF9rc2pLQ1hRLS0xa1VRdmVOOWJCbW91cmgyWEloNVhsMHRiMVowR3RleHVxTzJWYTlfM1hSQ0hjMkt3bGgxX24wRm1HSWpXdW12RWswbWVtWXFBbWtFc20yTVdiSElJRWdneWtNa1ZpU1lLQ3NiTVRoYnA1YU5oaXFoLTc4elBtQm9jVlVVajd2YlFwX00xakNaYU5qZ3kyTDI2cktZb0prU2VfYTRObHNfbTRfc2h0cTNvdURwYjVUQzkxS0Fma2xNUWJpaTZSdkhDU1RzSHB2ZEFOMWFRSXZnd3Vqd0xvMFZETGFiMU1reDNwTWx4c1VmX1FmM29mVUhaZnpPWFp5cmR5blVhNzU4NHUzamZ4MFhpdGRCYXRwZWNHbl8yUm1UN2wtMWtLNXhKYWg3MDNqUQ=="
    deployment: relay-web-app
    repo: 577012953595.dkr.ecr.us-west-2.amazonaws.com/relay-web-app
    container: web
    tag: commit-${DRONE_COMMIT}
